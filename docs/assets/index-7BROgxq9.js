const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ClaimPunchPage-BOPOHJ3p.js","assets/vendor-BIzLNe23.js","assets/vendor_firebase-DZXW4qMz.js","assets/vendor_react-dom-NUSA_c1V.js","assets/CustomerRecords-Nx-nqp_I.js"])))=>i.map(i=>d[i]);
import{j as e,Q as ee,b as o,R as re,c as O,B as te}from"./vendor-BIzLNe23.js";import{c as oe}from"./vendor_react-dom-NUSA_c1V.js";import{i as ne,g as se,d as L,o as ie,s as P,a as v}from"./vendor_firebase-DZXW4qMz.js";(function(){const x=document.createElement("link").relList;if(x&&x.supports&&x.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))m(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&m(n)}).observe(document,{childList:!0,subtree:!0});function a(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function m(t){if(t.ep)return;t.ep=!0;const l=a(t);fetch(t.href,l)}})();const le="modulepreload",ae=function(b){return"/loyalty_app/"+b},Q={},U=function(x,a,m){let t=Promise.resolve();if(a&&a.length>0){let n=function(i){return Promise.all(i.map(h=>Promise.resolve(h).then(r=>({status:"fulfilled",value:r}),r=>({status:"rejected",reason:r}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),C=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));t=n(a.map(i=>{if(i=ae(i),i in Q)return;Q[i]=!0;const h=i.endsWith(".css"),r=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${r}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":le,h||(p.as="script"),p.crossOrigin="",p.href=i,C&&p.setAttribute("nonce",C),document.head.appendChild(p),h)return new Promise((R,w)=>{p.addEventListener("load",R),p.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${i}`)))})}))}function l(n){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=n,window.dispatchEvent(s),!s.defaultPrevented)throw n}return t.then(n=>{for(const s of n||[])s.status==="rejected"&&l(s.reason);return x().catch(l)})};function de({totalPunches:b=10,currentPunches:x=0}){const a=[];for(let m=0;m<b;m++)a.push(e.jsx("div",{style:{width:"1rem",height:"1rem",borderRadius:"50%",backgroundColor:m<x?"#32D74B":"#E5E5EA"}},m));return e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"0.375rem"},children:a})}function ce({value:b="loyalty-program-user-123"}){return e.jsxs("div",{className:"qr-code-container",children:[e.jsx("h2",{children:"Scan QR Code"}),e.jsx("p",{children:"Present this QR code to earn or redeem points."}),e.jsx("div",{className:"qr-code-actual",children:b?e.jsx(ee,{value:b,size:128,bgColor:"#ffffff",fgColor:"#000000",level:"L"}):e.jsx("p",{children:"No QR code data available."})})]})}const ue={apiKey:"AIzaSyB3a-4cuYh3BgstXQPI4XCiTjmuyOtzsSM",authDomain:"ufoger-loyalty.firebaseapp.com",projectId:"ufoger-loyalty",storageBucket:"ufoger-loyalty.firebasestorage.app",messagingSenderId:"474748620137",appId:"1:474748620137:web:3340ce8e46c2406e2341f8"},me=ne(ue),T=se(me),pe=o.lazy(()=>U(()=>import("./ClaimPunchPage-BOPOHJ3p.js"),__vite__mapDeps([0,1,2,3]))),fe=o.lazy(()=>U(()=>import("./CustomerRecords-Nx-nqp_I.js"),__vite__mapDeps([4,1,2,3]))),xe="1234",he=({handleLockAdmin:b,customerPhoneNumber:x,handlePhoneNumberChange:a,customerNameInput:m,handleCustomerNameChange:t,loadCustomerData:l,isLoadingCustomer:n,activeCustomerData:s,currentPunches:C,totalPunches:i,isRewardAvailable:h,addPunch:r,isSavingPunch:p,handleGeneratePunchQrCode:R,redeemReward:w,isRedeemingReward:A,feedbackMessage:g})=>e.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:"1.25rem",boxSizing:"border-box",overflowY:"auto",padding:"0.1rem"},children:[e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#1C1C1E"},children:"Admin Controls"}),e.jsx("button",{onClick:b,style:{backgroundColor:"#D1D1D6",color:"#1C1C1E",padding:"0.375rem 0.75rem",borderRadius:"0.375rem",fontSize:"0.75rem",border:"none"},children:"Lock"})]}),e.jsx("input",{type:"tel",value:x,onChange:a,placeholder:"Customer Phone (ID)",disabled:n,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"},boxSizing:"border-box"}}),e.jsx("input",{type:"text",value:m,onChange:t,placeholder:"Customer Name",disabled:n,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"},boxSizing:"border-box"}}),e.jsx("button",{onClick:l,disabled:n||!x.trim(),style:{width:"100%",backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none",boxSizing:"border-box"},children:n?"Loading...":"Load/Create"})]}),s&&e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",textAlign:"center",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsxs("h3",{style:{color:"#1C1C1E",fontWeight:"bold",fontSize:"1.125rem"},children:[s.name||"N/A",e.jsxs("span",{style:{fontSize:"0.875rem",color:"#3C3C3E"},children:[" (",s.id,")"]})]}),e.jsx(de,{currentPunches:C,totalPunches:i,isRewardAvailable:h}),e.jsxs("p",{style:{fontSize:"0.875rem",color:"#3C3C3E"},children:[C," / ",i]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsx("button",{onClick:r,disabled:p||C>=i||n,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:p?"...":"Add Punch"}),e.jsx("button",{onClick:R,disabled:!s||C>=i||n,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:"Generate Punch QR"}),e.jsx("button",{onClick:w,disabled:A||!h||n,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:A?"...":"Redeem"})]})]}),g.text&&e.jsx("div",{style:{position:"fixed",bottom:"1.5rem",left:"50%",transform:"translateX(-50%)",padding:"0.75rem 1.25rem",borderRadius:"0.5rem",backgroundColor:g.type==="error"?"#FFEBEB":g.type==="success"?"#E6F7E9":"#E0F2FE",color:g.type==="error"?"#BF2C2C":g.type==="success"?"#1D7A2E":"#0C5A8A",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:1e3,fontSize:"0.875rem",border:"1px solid ",borderColor:g.type==="error"?"#FAD1D1":g.type==="success"?"#C6E6CC":"#B8DFF8"},children:g.text})]}),ge=({isAdminUnlocked:b,pinInput:x,handlePinInputChange:a,handlePinSubmit:m,handleLockAdmin:t,customerPhoneNumber:l,handlePhoneNumberChange:n,customerNameInput:s,handleCustomerNameChange:C,loadCustomerData:i,isLoadingCustomer:h,activeCustomerData:r,currentPunches:p,totalPunches:R,isRewardAvailable:w,addPunch:A,isSavingPunch:g,handleGeneratePunchQrCode:I,redeemReward:k,isRedeemingReward:B,feedbackMessage:E,isPunchQrModalOpen:N,actionableQrUrl:j,setIsPunchQrModalOpen:z})=>b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"1.5rem",width:"100%",maxWidth:"72rem",margin:"0 auto",boxSizing:"border-box",flexGrow:1,padding:"0 0.75rem 1rem 0.75rem",overflow:"hidden"},children:[e.jsx("div",{style:{flex:"1 1 0%",minWidth:"18rem",display:"flex",flexDirection:"column"},children:e.jsx(he,{handleLockAdmin:t,customerPhoneNumber:l,handlePhoneNumberChange:n,customerNameInput:s,handleCustomerNameChange:C,loadCustomerData:i,isLoadingCustomer:h,activeCustomerData:r,currentPunches:p,totalPunches:R,isRewardAvailable:w,addPunch:A,isSavingPunch:g,handleGeneratePunchQrCode:I,redeemReward:k,isRedeemingReward:B,feedbackMessage:E})}),e.jsx("div",{style:{flex:"2 1 0%",minWidth:"24rem",display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.1rem",paddingTop:"2rem"},children:"Loading records..."}),children:e.jsx(fe,{})})})]}),N&&j&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>z(!1),children:e.jsxs("div",{style:{backgroundColor:"#ffffff",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 10px rgba(0,0,0,0.1)",textAlign:"center",color:"#333333"},onClick:_=>_.stopPropagation(),children:[e.jsx("h4",{style:{marginBottom:"15px",fontSize:"1.2rem",color:"#333333"},children:"Scan to Get Punch"}),e.jsx(ce,{value:j,size:200}),e.jsx("p",{style:{fontSize:"0.8rem",marginTop:"15px",wordBreak:"break-all",color:"#555555"},children:j}),e.jsx("button",{onClick:()=>z(!1),style:{marginTop:"20px",backgroundColor:"#007bff",color:"#ffffff",padding:"10px 15px",borderRadius:"5px",border:"none",cursor:"pointer"},children:"Close"})]})})]}):e.jsxs("div",{style:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem 0.75rem",boxSizing:"border-box"},children:[e.jsxs("div",{style:{maxWidth:"24rem",width:"100%",backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsx("h2",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#1C1C1E"},children:"Admin Access"}),e.jsx("input",{type:"password",value:x,onChange:a,placeholder:"Enter PIN",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"},boxSizing:"border-box"}}),e.jsx("button",{onClick:m,style:{width:"100%",backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none",boxSizing:"border-box"},children:"Unlock"})]}),E.text&&e.jsx("div",{style:{position:"fixed",bottom:"1.5rem",left:"50%",transform:"translateX(-50%)",padding:"0.75rem 1.25rem",borderRadius:"0.5rem",backgroundColor:E.type==="error"?"#FFEBEB":E.type==="success"?"#E6F7E9":"#E0F2FE",color:E.type==="error"?"#BF2C2C":E.type==="success"?"#1D7A2E":"#0C5A8A",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:1e3,fontSize:"0.875rem",border:"1px solid ",borderColor:E.type==="error"?"#FAD1D1":E.type==="success"?"#C6E6CC":"#B8DFF8"},children:E.text})]});function be(){const[b,x]=o.useState(0),a=10,[m,t]=o.useState(!1),[l,n]=o.useState(""),[s,C]=o.useState(""),[i,h]=o.useState(""),[r,p]=o.useState(null),[R,w]=o.useState(!1),[A,g]=o.useState(!1),[I,k]=o.useState(!1),[B,E]=o.useState(!1),[N,j]=o.useState({text:"",type:""}),[z,_]=o.useState(""),[$,W]=o.useState(!1),f=o.useRef(null);o.useEffect(()=>{r?(x(r.punches),w(r.punches>=a),!i&&r.name&&h(r.name)):(x(0),w(!1))},[r,a,i]),o.useEffect(()=>()=>{f.current&&f.current()},[]);const d=(u,c="info")=>{j({text:u,type:c}),setTimeout(()=>{j({text:"",type:""})},2500)},G=()=>{if(!r||!r.id){d("Please load a customer first.","error");return}if(r.punches>=a){d("Reward is already available. Cannot add more punches.","error");return}const u=`PUNCH_TOKEN_${r.id}_${Date.now()}_${Math.random().toString(36).substring(2,10)}`;let c;window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?(c=`${window.location.origin+"/loyalty_app/"}claim?token=${u}`,console.log("Generated local preview QR URL:",c)):(c=`https://ufoger-usa.github.io/loyalty_app/claim?token=${u}`,console.log("Generated production QR URL:",c)),_(c),W(!0),d("QR code for customer to scan and get a punch is ready.","info")},q=async()=>{if(!m){d("Please unlock admin access.","error");return}if(!r){d("Please load a customer first.","error");return}if(r.punches>=a){d("Reward is available! Please redeem before adding more punches.","error");return}k(!0),j({text:"",type:""});const u=r.punches<a?r.punches+1:r.punches,c=r.name||i.trim();try{const y=L(T,"customers",r.id);await P(y,{punches:u,name:c,updatedAt:v()},{merge:!0}),d(`Punch added for ${c||r.id}!`,"success")}catch(y){console.error("Error saving punch to Firestore:",y),d("Error saving punch. Please try again.","error")}finally{k(!1)}},X=async()=>{if(!m){d("Please unlock admin access.","error");return}if(!r||r.punches<a){d("Customer is not eligible for a reward yet or no customer loaded.","error");return}E(!0),j({text:"",type:""});const u=r.name||"Customer",c=r.totalRedemptions||0;try{const y=L(T,"customers",r.id);await P(y,{punches:0,lastRewardRedeemedAt:v(),totalRedemptions:c+1,updatedAt:v()},{merge:!0}),d(`Reward redeemed for ${u}! Punches reset.`,"success")}catch(y){console.error("Error redeeming reward in Firestore:",y),d("Error redeeming reward. Please try again.","error")}finally{E(!1)}},K=o.useCallback(u=>{n(u.target.value)},[]),V=()=>{l===xe?(t(!0),n(""),j({text:"",type:""})):(d("Incorrect PIN","error"),n(""))},H=()=>{t(!1),j({text:"",type:""}),p(null),C(""),h(""),f.current&&(f.current(),f.current=null)},Y=o.useCallback(u=>{C(u.target.value)},[]),J=o.useCallback(u=>{h(u.target.value)},[]),Z=o.useCallback(async()=>{const u=s.trim(),c=i.trim();if(!u){d("Please enter a customer phone number.","error");return}f.current&&(f.current(),f.current=null),g(!0),j({text:"",type:""});const y=u,D=L(T,"customers",y);try{f.current=ie(D,async S=>{if(g(!1),S.exists()){const F=S.data(),M={id:S.id,punches:F.punches||0,name:F.name||"",lastRewardRedeemedAt:F.lastRewardRedeemedAt,createdAt:F.createdAt,updatedAt:F.updatedAt,totalRedemptions:F.totalRedemptions||0};p(M),c&&c!==F.name?(await P(D,{name:c,updatedAt:v()},{merge:!0}),d("Customer name updated.","success")):!F.name&&c?(await P(D,{name:c,updatedAt:v()},{merge:!0}),d("Customer name added.","success")):d(`Customer ${F.name||y} loaded.`,"info")}else{const F={id:y,punches:0,name:c,createdAt:v(),updatedAt:v(),lastRewardRedeemedAt:null,totalRedemptions:0};await P(D,F),d(`New customer ${c||y} created.`,"success")}},S=>{console.error("Error in Firestore listener:",S),d("Error listening to customer data. Try reloading.","error"),g(!1),f.current&&(f.current(),f.current=null)})}catch(S){console.error("Error loading or creating customer data:",S),d("Error accessing customer data. Please try again.","error"),g(!1),f.current&&(f.current(),f.current=null)}},[s,i,f]);return e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh",backgroundColor:"#FFFFFF",color:"#1C1C1E",fontFamily:"sans-serif",boxSizing:"border-box"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"1rem 0.75rem",flexShrink:0},children:[e.jsx("h2",{style:{fontSize:"0.75rem",letterSpacing:"0.1em",color:"#3C3C3E",textTransform:"uppercase",fontWeight:"600",marginBottom:"0.25rem"},children:"UFOGER Loyalty System"}),e.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#1C1C1E"},children:"Admin Panel"})]}),e.jsx("main",{style:{width:"100%",boxSizing:"border-box",flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.25rem",paddingTop:"2rem"},children:"Loading page..."}),children:e.jsxs(re,{children:[e.jsx(O,{path:"/",element:e.jsx(ge,{isAdminUnlocked:m,pinInput:l,handlePinInputChange:K,handlePinSubmit:V,handleLockAdmin:H,customerPhoneNumber:s,handlePhoneNumberChange:Y,customerNameInput:i,handleCustomerNameChange:J,loadCustomerData:Z,isLoadingCustomer:A,activeCustomerData:r,currentPunches:b,totalPunches:a,isRewardAvailable:R,addPunch:q,isSavingPunch:I,handleGeneratePunchQrCode:G,redeemReward:X,isRedeemingReward:B,feedbackMessage:N,isPunchQrModalOpen:$,actionableQrUrl:z,setIsPunchQrModalOpen:W})}),e.jsx(O,{path:"/claim",element:e.jsx(pe,{})})]})})})]})}oe.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(te,{basename:"/loyalty_app",children:e.jsx(be,{})})}));export{T as d};
