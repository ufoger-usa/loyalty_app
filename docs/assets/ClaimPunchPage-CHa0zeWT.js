import{u as x,d as y,b as m,j as e}from"./vendor-BIzLNe23.js";import{d as g}from"./index-DeJFvr5w.js";import{d as w,r as C,a as f,b as j}from"./vendor_firebase-BWxY0-Ns.js";import"./vendor_react-dom-NUSA_c1V.js";const D=()=>{const[l]=x(),s=y(),[a,t]=m.useState("Processing your punch..."),[c,r]=m.useState("");return m.useEffect(()=>{const u=l.get("token");if(!u){r("No token provided."),t("");return}(async()=>{try{if(!u.startsWith("PUNCH_TOKEN_")){r("Invalid token format."),t("");return}const o=u.split("_");if(o.length<4){r("Invalid token structure."),t("");return}const i=o[2];if(!i){r("Could not identify customer from token."),t("");return}await new Promise(n=>setTimeout(n,1e3));const d=w(g,"customers",i);await C(g,async n=>{const h=await n.get(d);if(!h.exists())throw new Error("Customer not found.");const p=h.data().punches||0;if(p>=10){t("Reward already available! No more punches can be added."),setTimeout(()=>s("/"),5e3);return}const P=p+1;n.update(d,{punches:P,updatedAt:f(),lastPunchClaimedAt:f()})}),t(`Punch successfully claimed for customer ${i}! You now have ${(await j(d)).data().punches} punches. Redirecting...`),setTimeout(()=>s("/"),5e3)}catch(o){console.error("Error processing punch claim:",o),r(`Error: ${o.message||"Could not process your punch. Please try again or contact support."}`),t(""),setTimeout(()=>s("/"),7e3)}})()},[l,s]),c?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"red"},children:[e.jsx("h1",{children:"Punch Claim Error"}),e.jsx("p",{children:a}),e.jsx("p",{children:c}),e.jsx("button",{onClick:()=>s("/"),children:"Go to Homepage"})]}):e.jsxs("div",{style:{padding:"20px",textAlign:"center",cursor:a==="Processing your punch..."&&!c?"wait":"auto"},children:[e.jsx("h1",{children:"Claiming Your Punch"}),e.jsx("p",{children:a})]})};export{D as default};
