import{b as c,j as r}from"./vendor-BOSIRU9y.js";import{q as w,b as A,c as k,o as D,d as L,e as N}from"./vendor_firebase-CiCfdIqM.js";import{d as y}from"./index-S-Thn3GS.js";import"./vendor_react-dom-hwKM03QV.js";const P=()=>{const[p,S]=c.useState([]),[m,C]=c.useState(""),[j,x]=c.useState(!0),[f,v]=c.useState(null),[t,g]=c.useState({key:"totalRedemptions",direction:"desc"});c.useEffect(()=>{x(!0);const e=w(k(y,"customers"),A("createdAt","desc")),n=D(e,d=>{const o=[];d.forEach(s=>{o.push({id:s.id,...s.data()})}),S(o),x(!1)},d=>{console.error("Error fetching customer records: ",d),v("Failed to load customer records."),x(!1)});return()=>n()},[]);const R=async(e,n)=>{const d=n||e;if(window.confirm(`Are you sure you want to delete customer ${d}? This action cannot be undone.`))try{const o=L(y,"customers",e);await N(o),alert(`Customer ${d} deleted successfully.`)}catch(o){console.error("Error deleting customer: ",o),alert(`Failed to delete customer ${d}. Error: ${o.message}`)}},h=c.useMemo(()=>{let e=[...p];return m&&(e=e.filter(n=>n.id.toLowerCase().includes(m.toLowerCase())||n.name&&n.name.toLowerCase().includes(m.toLowerCase()))),t.key&&e.sort((n,d)=>{const o=(u,l)=>u?l==="createdAt"||l==="lastRedeemedAt"?u[l]?u[l].seconds:null:l==="name"?u[l]||"":u[l]:null,s=o(n,t.key),i=o(d,t.key);let a=0;return s==null?a=i==null?0:1:i==null?a=-1:typeof s=="string"&&typeof i=="string"?a=s.toLowerCase().localeCompare(i.toLowerCase()):typeof s=="number"&&typeof i=="number"?a=s-i:a=String(s).localeCompare(String(i)),t.direction==="asc"?a:-a}),e},[p,m,t]),b=e=>e?new Date(e.seconds*1e3).toLocaleDateString():"N/A";return r.jsxs("div",{style:{backgroundColor:"white",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06)",borderRadius:"0.5rem",padding:"1.5rem",border:"1px solid #e5e7eb",display:"flex",flexDirection:"column",height:"100%",minHeight:"0",boxSizing:"border-box"},children:[r.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1f2937",marginBottom:"1rem",flexShrink:0},children:"Customer Records"}),r.jsx("input",{type:"text",placeholder:"Search by Phone or Name...",style:{width:"100%",padding:"0.5rem",marginBottom:"1rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",flexShrink:0,boxSizing:"border-box"},value:m,onChange:e=>C(e.target.value)}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",alignItems:"center",flexShrink:0},children:[r.jsxs("select",{value:t.key,onChange:e=>g({...t,key:e.target.value}),style:{padding:"0.5rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",backgroundColor:"white",fontSize:"0.875rem"},children:[r.jsx("option",{value:"createdAt",children:"Created Date"}),r.jsx("option",{value:"name",children:"Name"}),r.jsx("option",{value:"punches",children:"Punches"}),r.jsx("option",{value:"lastRedeemedAt",children:"Last Redeemed"}),r.jsx("option",{value:"totalRedemptions",children:"Total Redemptions"})]}),r.jsxs("button",{onClick:()=>g({...t,direction:t.direction==="asc"?"desc":"asc"}),style:{padding:"0.375rem 0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",transition:"background-color 0.2s",fontSize:"0.875rem"},children:["Sort ",t.direction==="asc"?"Ascending":"Descending"]})]}),j?r.jsx("div",{style:{textAlign:"center",padding:"1rem",flexShrink:0},children:"Loading customer records..."}):f?r.jsx("div",{style:{textAlign:"center",padding:"1rem",color:"#ef4444",flexShrink:0},children:f}):h.length===0?r.jsx("p",{style:{color:"#6b7280",flexShrink:0},children:"No customers found."}):r.jsx("ul",{style:{listStyle:"none",margin:0,paddingLeft:0,flexGrow:1,overflowY:"auto",minHeight:"0",maxHeight:"400px",paddingBottom:"0.5rem",boxSizing:"border-box"},children:h.map(e=>r.jsxs("li",{style:{padding:"0.75rem",backgroundColor:"#f9fafb",borderRadius:"0.375rem",border:"1px solid #e5e7eb",marginBottom:"0.75rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[r.jsxs("div",{children:[" ",r.jsxs("div",{className:"font-medium text-gray-700",children:[e.name||"N/A"," - ",r.jsx("span",{className:"text-sm text-sky-600",children:e.id})]}),r.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Punches: ",e.punches||0," / ",e.totalPunches||10]}),r.jsxs("div",{className:"text-sm text-gray-600",children:["Total Redemptions: ",e.totalRedemptions||0]}),r.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Created: ",b(e.createdAt)]}),e.lastRedeemedAt&&r.jsxs("div",{className:"text-xs text-gray-400",children:["Last Redeemed: ",b(e.lastRedeemedAt)]})]}),r.jsx("button",{onClick:()=>R(e.id,e.name),style:{backgroundColor:"#fee2e2",color:"#b91c1c",padding:"0.25rem 0.5rem",borderRadius:"0.25rem",border:"1px solid #fecaca",fontSize:"0.75rem",cursor:"pointer",alignSelf:"flex-start"},children:"Delete Customer"})]},e.id))})]})};export{P as default};
