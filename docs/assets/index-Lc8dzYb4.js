const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ClaimPunchPage-E-kDE7m1.js","assets/vendor-BIzLNe23.js","assets/vendor_firebase-BWxY0-Ns.js","assets/vendor_react-dom-NUSA_c1V.js"])))=>i.map(i=>d[i]);
import{j as e,Q as Z,b as s,R as ee,c as D,B as te}from"./vendor-BIzLNe23.js";import{c as re}from"./vendor_react-dom-NUSA_c1V.js";import{i as se,g as ne,d as Q,o as ae,s as S,a as A}from"./vendor_firebase-BWxY0-Ns.js";(function(){const x=document.createElement("link").relList;if(x&&x.supports&&x.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))y(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&y(d)}).observe(document,{childList:!0,subtree:!0});function i(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function y(r){if(r.ep)return;r.ep=!0;const n=i(r);fetch(r.href,n)}})();const oe="modulepreload",ce=function(f){return"/loyalty_app/"+f},U={},ie=function(x,i,y){let r=Promise.resolve();if(i&&i.length>0){let d=function(c){return Promise.all(c.map(l=>Promise.resolve(l).then(t=>({status:"fulfilled",value:t}),t=>({status:"rejected",reason:t}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),N=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=d(i.map(c=>{if(c=ce(c),c in U)return;U[c]=!0;const l=c.endsWith(".css"),t=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${t}`))return;const p=document.createElement("link");if(p.rel=l?"stylesheet":oe,l||(p.as="script"),p.crossOrigin="",p.href=c,N&&p.setAttribute("nonce",N),document.head.appendChild(p),l)return new Promise((v,P)=>{p.addEventListener("load",v),p.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(d){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=d,window.dispatchEvent(o),!o.defaultPrevented)throw d}return r.then(d=>{for(const o of d||[])o.status==="rejected"&&n(o.reason);return x().catch(n)})};function le({totalPunches:f=10,currentPunches:x=0,isRewardAvailable:i=!1}){const y=[];for(let r=0;r<f;r++)y.push(e.jsx("span",{className:`punch-mark ${r<x?"punched":"not-punched"}`},r));return e.jsxs("div",{className:`punch-card-container compact-punch-card ${i?"reward-active":""}`,children:[e.jsx("div",{className:"punches-display",children:y}),e.jsxs("p",{className:"punch-count-text",children:[x," / ",f]}),i&&e.jsx("div",{className:"reward-indicator",children:e.jsx("p",{children:"ðŸŽ‰ Reward Ready! ðŸŽ‰"})})]})}function ue({value:f="loyalty-program-user-123"}){return e.jsxs("div",{className:"qr-code-container",children:[e.jsx("h2",{children:"Scan QR Code"}),e.jsx("p",{children:"Present this QR code to earn or redeem points."}),e.jsx("div",{className:"qr-code-actual",children:f?e.jsx(Z,{value:f,size:128,bgColor:"#ffffff",fgColor:"#000000",level:"L"}):e.jsx("p",{children:"No QR code data available."})})]})}const de={apiKey:"AIzaSyB3a-4cuYh3BgstXQPI4XCiTjmuyOtzsSM",authDomain:"ufoger-loyalty.firebaseapp.com",projectId:"ufoger-loyalty",storageBucket:"ufoger-loyalty.firebasestorage.app",messagingSenderId:"474748620137",appId:"1:474748620137:web:3340ce8e46c2406e2341f8"},me=se(de),q=ne(me),pe=s.lazy(()=>ie(()=>import("./ClaimPunchPage-E-kDE7m1.js"),__vite__mapDeps([0,1,2,3]))),he="1234",fe=({isAdminUnlocked:f,pinInput:x,handlePinInputChange:i,handlePinSubmit:y,handleLockAdmin:r,customerPhoneNumber:n,handlePhoneNumberChange:d,customerNameInput:o,handleCustomerNameChange:N,loadCustomerData:c,isLoadingCustomer:l,activeCustomerData:t,currentPunches:p,totalPunches:v,isRewardAvailable:P,addPunch:$,isSavingPunch:R,handleGeneratePunchQrCode:L,redeemReward:k,isRedeemingReward:E,feedbackMessage:j,isPunchQrModalOpen:O,actionableQrUrl:b,setIsPunchQrModalOpen:I})=>e.jsxs(e.Fragment,{children:[j.text&&e.jsx("div",{className:`feedback-message ${j.type} ${j.type==="error"?"feedback-error":j.type==="success"?"feedback-success":"feedback-info"}`,children:j.text}),f?e.jsxs("div",{className:"admin-unlocked",children:[e.jsxs("div",{className:"admin-controls-header compact-header",children:[e.jsx("h4",{children:"Admin Controls"}),e.jsx("button",{onClick:r,className:"admin-button lock-button compact-button danger-button",children:"Lock"})]}),e.jsxs("div",{className:"customer-management compact-section",children:[e.jsx("h5",{children:"Load/Create Customer"}),e.jsxs("div",{className:"input-group compact-input-group",children:[e.jsx("input",{type:"tel",value:n,onChange:d,placeholder:"Phone Number",className:"customer-input compact-input",disabled:l}),e.jsx("input",{type:"text",value:o,onChange:N,placeholder:"Name (Optional)",className:"customer-input compact-input",disabled:l}),e.jsx("button",{onClick:c,disabled:l||!n.trim(),className:"action-button compact-button",children:l?"Loading...":"Load/Create"})]})]}),t&&e.jsxs("div",{className:"customer-info compact-section",children:[e.jsxs("div",{className:"customer-details",children:[e.jsxs("h5",{children:[t.name||"N/A"," (",t.id,")"]}),e.jsx(le,{currentPunches:p,totalPunches:v,isRewardAvailable:P})]}),e.jsxs("div",{className:"actions-group compact-actions-group",children:[e.jsx("button",{onClick:$,disabled:R||p>=v||l,className:"action-button compact-button",children:R?"...":"Add Punch"}),e.jsx("button",{onClick:L,disabled:!t||p>=v||l,className:"action-button compact-button qr-button",children:"Generate Punch QR"}),e.jsx("button",{onClick:k,disabled:E||!P||l,className:"action-button redeem-button compact-button danger-button",children:E?"...":"Redeem"})]})]})]}):e.jsxs("div",{className:"admin-lock compact-section",children:[e.jsx("h4",{children:"Admin Access"}),e.jsx("input",{type:"password",value:x,onChange:i,placeholder:"Enter PIN",className:"pin-input compact-input"}),e.jsx("button",{onClick:y,className:"admin-button compact-button",children:"Unlock"})]}),O&&b&&e.jsx("div",{className:"modal-overlay",onClick:()=>I(!1),children:e.jsxs("div",{className:"modal-content compact-modal",onClick:T=>T.stopPropagation(),children:[e.jsx("h4",{children:"Scan to Get Punch"}),e.jsx(ue,{value:b,size:200}),e.jsx("p",{className:"qr-url-display small-text",children:b}),e.jsx("button",{onClick:()=>I(!1),className:"admin-button compact-button",children:"Close"})]})})]});function xe(){const[f,x]=s.useState(0),i=10,[y,r]=s.useState(!1),[n,d]=s.useState(""),[o,N]=s.useState(""),[c,l]=s.useState(""),[t,p]=s.useState(null),[v,P]=s.useState(!1),[$,R]=s.useState(!1),[L,k]=s.useState(!1),[E,j]=s.useState(!1),[O,b]=s.useState({text:"",type:""}),[I,T]=s.useState(""),[B,F]=s.useState(!1),m=s.useRef(null);s.useEffect(()=>{t?(x(t.punches),P(t.punches>=i),!c&&t.name&&l(t.name)):(x(0),P(!1))},[t,i,c]),s.useEffect(()=>()=>{m.current&&m.current()},[]);const a=(h,u="info")=>{b({text:h,type:u}),setTimeout(()=>{b({text:"",type:""})},2500)},z=()=>{if(!t||!t.id){a("Please load a customer first.","error");return}if(t.punches>=i){a("Reward is already available. Cannot add more punches.","error");return}const u=`https://ufoger-usa.github.io/loyalty_app/claim?token=${`PUNCH_TOKEN_${t.id}_${Date.now()}_${Math.random().toString(36).substring(2,10)}`}`;T(u),F(!0),a("QR code for customer to scan and get a punch is ready.","info")},G=async()=>{if(!y){a("Please unlock admin access.","error");return}if(!t){a("Please load a customer first.","error");return}if(t.punches>=i){a("Reward is available! Please redeem before adding more punches.","error");return}k(!0),b({text:"",type:""});const h=t.punches<i?t.punches+1:t.punches,u=t.name||c.trim();try{const C=Q(q,"customers",t.id);await S(C,{punches:h,name:u,updatedAt:A()},{merge:!0}),a(`Punch added for ${u||t.id}!`,"success")}catch(C){console.error("Error saving punch to Firestore:",C),a("Error saving punch. Please try again.","error")}finally{k(!1)}},K=async()=>{if(!y){a("Please unlock admin access.","error");return}if(!t||t.punches<i){a("Customer is not eligible for a reward yet or no customer loaded.","error");return}j(!0),b({text:"",type:""});const h=t.name||"Customer";try{const u=Q(q,"customers",t.id);await S(u,{punches:0,lastRewardRedeemedAt:A(),updatedAt:A()},{merge:!0}),a(`Reward redeemed for ${h}! Punches reset.`,"success")}catch(u){console.error("Error redeeming reward in Firestore:",u),a("Error redeeming reward. Please try again.","error")}finally{j(!1)}},V=s.useCallback(h=>{d(h.target.value)},[]),X=()=>{n===he?(r(!0),d(""),b({text:"",type:""})):(a("Incorrect PIN","error"),d(""))},H=()=>{r(!1),b({text:"",type:""}),p(null),N(""),l(""),m.current&&(m.current(),m.current=null)},M=s.useCallback(h=>{N(h.target.value)},[]),W=s.useCallback(h=>{l(h.target.value)},[]),Y=s.useCallback(async()=>{const h=o.trim(),u=c.trim();if(!h){a("Please enter a customer phone number.","error");return}m.current&&(m.current(),m.current=null),R(!0),b({text:"",type:""});const C=h,_=Q(q,"customers",C);try{m.current=ae(_,async w=>{if(R(!1),w.exists()){const g=w.data(),J={id:w.id,punches:g.punches||0,name:g.name||"",lastRewardRedeemedAt:g.lastRewardRedeemedAt,createdAt:g.createdAt,updatedAt:g.updatedAt};p(J),u&&u!==g.name?(await S(_,{name:u,updatedAt:A()},{merge:!0}),a("Customer name updated.","success")):!g.name&&u?(await S(_,{name:u,updatedAt:A()},{merge:!0}),a("Customer name added.","success")):a(`Customer ${g.name||C} loaded.`,"info")}else{const g={id:C,punches:0,name:u,createdAt:A(),updatedAt:A(),lastRewardRedeemedAt:null};await S(_,g),a(`New customer ${u||C} created.`,"success")}},w=>{console.error("Error in Firestore listener:",w),a("Error listening to customer data. Try reloading.","error"),R(!1),m.current&&(m.current(),m.current=null)})}catch(w){console.error("Error loading or creating customer data:",w),a("Error accessing customer data. Please try again.","error"),R(!1),m.current&&(m.current(),m.current=null)}},[o,c,m]);return e.jsxs("div",{className:"App",children:[e.jsx("header",{className:"App-header compact-app-header",children:e.jsx("h1",{children:"Loyalty Card"})}),e.jsx("main",{className:"App-main",children:e.jsx(s.Suspense,{fallback:e.jsx("div",{children:"Loading page..."}),children:e.jsxs(ee,{children:[e.jsx(D,{path:"/",element:e.jsx(fe,{isAdminUnlocked:y,pinInput:n,handlePinInputChange:V,handlePinSubmit:X,handleLockAdmin:H,customerPhoneNumber:o,handlePhoneNumberChange:M,customerNameInput:c,handleCustomerNameChange:W,loadCustomerData:Y,isLoadingCustomer:$,activeCustomerData:t,currentPunches:f,totalPunches:i,isRewardAvailable:v,addPunch:G,isSavingPunch:L,handleGeneratePunchQrCode:z,redeemReward:K,isRedeemingReward:E,feedbackMessage:O,isPunchQrModalOpen:B,actionableQrUrl:I,setIsPunchQrModalOpen:F})}),e.jsx(D,{path:"/claim",element:e.jsx(pe,{})})]})})})]})}re.createRoot(document.getElementById("root")).render(e.jsx(s.StrictMode,{children:e.jsx(te,{basename:"/loyalty_app",children:e.jsx(xe,{})})}));export{q as d};
