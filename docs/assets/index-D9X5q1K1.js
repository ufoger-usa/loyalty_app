const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ClaimPunchPage-B4ndIgnD.js","assets/vendor-BIzLNe23.js","assets/vendor_firebase-BWxY0-Ns.js","assets/vendor_react-dom-NUSA_c1V.js"])))=>i.map(i=>d[i]);
import{j as e,Q as te,b as a,R as re,c as U,B as se}from"./vendor-BIzLNe23.js";import{c as ne}from"./vendor_react-dom-NUSA_c1V.js";import{i as ae,g as oe,d as $,o as ce,s as A,a as j}from"./vendor_firebase-BWxY0-Ns.js";(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))b(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&b(p)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function b(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();const ie="modulepreload",le=function(h){return"/loyalty_app/"+h},q={},ue=function(f,o,b){let r=Promise.resolve();if(o&&o.length>0){let p=function(d){return Promise.all(d.map(g=>Promise.resolve(g).then(t=>({status:"fulfilled",value:t}),t=>({status:"rejected",reason:t}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),R=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=p(o.map(d=>{if(d=le(d),d in q)return;q[d]=!0;const g=d.endsWith(".css"),t=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${t}`))return;const u=document.createElement("link");if(u.rel=g?"stylesheet":ie,g||(u.as="script"),u.crossOrigin="",u.href=d,R&&u.setAttribute("nonce",R),document.head.appendChild(u),g)return new Promise((S,k)=>{u.addEventListener("load",S),u.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(p){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=p,window.dispatchEvent(l),!l.defaultPrevented)throw p}return r.then(p=>{for(const l of p||[])l.status==="rejected"&&i(l.reason);return f().catch(i)})};function de({totalPunches:h=10,currentPunches:f=0,isRewardAvailable:o=!1}){const b=[];for(let r=0;r<h;r++)b.push(e.jsx("span",{className:`punch-mark ${r<f?"punched":"not-punched"}`},r));return e.jsxs("div",{className:`punch-card-container compact-punch-card ${o?"reward-active":""}`,children:[e.jsx("div",{className:"punches-display",children:b}),e.jsxs("p",{className:"punch-count-text",children:[f," / ",h]}),o&&e.jsx("div",{className:"reward-indicator",children:e.jsx("p",{children:"ðŸŽ‰ Reward Ready! ðŸŽ‰"})})]})}function me({value:h="loyalty-program-user-123"}){return e.jsxs("div",{className:"qr-code-container",children:[e.jsx("h2",{children:"Scan QR Code"}),e.jsx("p",{children:"Present this QR code to earn or redeem points."}),e.jsx("div",{className:"qr-code-actual",children:h?e.jsx(te,{value:h,size:128,bgColor:"#ffffff",fgColor:"#000000",level:"L"}):e.jsx("p",{children:"No QR code data available."})})]})}const pe={apiKey:"AIzaSyB3a-4cuYh3BgstXQPI4XCiTjmuyOtzsSM",authDomain:"ufoger-loyalty.firebaseapp.com",projectId:"ufoger-loyalty",storageBucket:"ufoger-loyalty.firebasestorage.app",messagingSenderId:"474748620137",appId:"1:474748620137:web:3340ce8e46c2406e2341f8"},he=ae(pe),Q=oe(he),fe=a.lazy(()=>ue(()=>import("./ClaimPunchPage-B4ndIgnD.js"),__vite__mapDeps([0,1,2,3]))),ge="1234";function xe(){const[h,f]=a.useState(0),o=10,[b,r]=a.useState(!1),[i,p]=a.useState(""),[l,R]=a.useState(""),[d,g]=a.useState(""),[t,u]=a.useState(null),[S,k]=a.useState(!1),[N,E]=a.useState(!1),[_,D]=a.useState(!1),[T,F]=a.useState(!1),[w,v]=a.useState({text:"",type:""}),[I,B]=a.useState(""),[z,L]=a.useState(!1),m=a.useRef(null);a.useEffect(()=>{t?(f(t.punches),k(t.punches>=o),!d&&t.name&&g(t.name)):(f(0),k(!1))},[t,o]),a.useEffect(()=>()=>{m.current&&m.current()},[]);const s=(c,n="info")=>{v({text:c,type:n}),setTimeout(()=>{v({text:"",type:""})},2500)},M=()=>{if(!t||!t.id){s("Please load a customer first.","error");return}if(t.punches>=o){s("Reward is already available. Cannot add more punches.","error");return}const n=`https://ufoger-usa.github.io/loyalty_app/claim?token=${`PUNCH_TOKEN_${t.id}_${Date.now()}_${Math.random().toString(36).substring(2,10)}`}`;B(n),L(!0),s("QR code for customer to scan and get a punch is ready.","info")},G=async()=>{if(!b){s("Please unlock admin access.","error");return}if(!t){s("Please load a customer first.","error");return}if(t.punches>=o){s("Reward is available! Please redeem before adding more punches.","error");return}D(!0),v({text:"",type:""});const c=t.punches<o?t.punches+1:t.punches,n=t.name||d.trim(),y={...t,punches:c,name:n};u(y);try{const C=$(Q,"customers",t.id);await A(C,{punches:c,name:n,updatedAt:j()},{merge:!0}),s(`Punch added for ${n||t.id}!`,"success")}catch(C){console.error("Error saving punch to Firestore:",C),s("Error saving punch. Please try again.","error")}finally{D(!1)}},K=async()=>{if(!b){s("Please unlock admin access.","error");return}if(!t||t.punches<o){s("Customer is not eligible for a reward yet or no customer loaded.","error");return}F(!0),v({text:"",type:""});const c=t.name||"Customer",n={...t,punches:0,lastRewardRedeemedAt:new Date().toISOString()};u(n);try{const y=$(Q,"customers",t.id);await A(y,{punches:0,lastRewardRedeemedAt:j(),updatedAt:j()},{merge:!0}),s(`Reward redeemed for ${c}! Punches reset.`,"success")}catch(y){console.error("Error redeeming reward in Firestore:",y),s("Error redeeming reward. Please try again.","error")}finally{F(!1)}},V=c=>{p(c.target.value)},X=()=>{i===ge?(r(!0),p(""),v({text:"",type:""})):(s("Incorrect PIN","error"),p(""))},H=()=>{r(!1),v({text:"",type:""}),u(null),R(""),g(""),m.current&&(m.current(),m.current=null)},W=c=>{R(c.target.value)},Y=c=>{g(c.target.value)},J=async()=>{const c=l.trim(),n=d.trim();if(!c){s("Please enter a customer phone number.","error");return}m.current&&(m.current(),m.current=null),E(!0),u(null),v({text:"",type:""});const y=c,C=$(Q,"customers",y);try{m.current=ce(C,async P=>{if(P.exists()){const x=P.data(),ee={id:P.id,punches:x.punches||0,name:x.name||"",lastRewardRedeemedAt:x.lastRewardRedeemedAt,createdAt:x.createdAt,updatedAt:x.updatedAt};u(ee),x.name&&g(x.name),n&&n!==x.name?(await A(C,{name:n,updatedAt:j()},{merge:!0}),u(O=>({...O,name:n})),s("Customer name updated.","success")):!x.name&&n?(await A(C,{name:n,updatedAt:j()},{merge:!0}),u(O=>({...O,name:n})),s("Customer name added.","success")):s(`Customer ${x.name||y} loaded.`,"info")}else{n||s("New customer. Please consider adding a name.","warning");const x={id:y,punches:0,name:n,createdAt:j(),updatedAt:j(),lastRewardRedeemedAt:null};await A(C,{punches:0,name:n,createdAt:j(),updatedAt:j(),lastRewardRedeemedAt:null}),s(`New customer ${n||y} created.`,"success")}E(!1)},P=>{console.error("Error in Firestore listener:",P),s("Error listening to customer data. Try reloading.","error"),E(!1),m.current&&(m.current(),m.current=null)})}catch(P){console.error("Error loading or creating customer data:",P),s("Error accessing customer data. Please try again.","error"),E(!1),m.current&&(m.current(),m.current=null)}},Z=()=>e.jsxs(e.Fragment,{children:[w.text&&e.jsx("div",{className:`feedback-message ${w.type} ${w.type==="error"?"feedback-error":w.type==="success"?"feedback-success":"feedback-info"}`,children:w.text}),b?e.jsxs("div",{className:"admin-unlocked",children:[e.jsxs("div",{className:"admin-controls-header compact-header",children:[e.jsx("h4",{children:"Admin Controls"}),e.jsx("button",{onClick:H,className:"admin-button lock-button compact-button danger-button",children:"Lock"})]}),e.jsxs("div",{className:"customer-management compact-section",children:[e.jsx("h5",{children:"Load/Create Customer"}),e.jsxs("div",{className:"input-group compact-input-group",children:[e.jsx("input",{type:"tel",value:l,onChange:W,placeholder:"Phone Number",className:"customer-input compact-input",disabled:N}),e.jsx("input",{type:"text",value:d,onChange:Y,placeholder:"Name (Optional)",className:"customer-input compact-input",disabled:N}),e.jsx("button",{onClick:J,disabled:N||!l.trim(),className:"action-button compact-button",children:N?"Loading...":"Load/Create"})]})]}),t&&e.jsxs("div",{className:"customer-info compact-section",children:[e.jsxs("div",{className:"customer-details",children:[e.jsxs("h5",{children:[t.name||"N/A"," (",t.id,")"]}),e.jsx(de,{currentPunches:h,totalPunches:o,isRewardAvailable:S})]}),e.jsxs("div",{className:"actions-group compact-actions-group",children:[e.jsx("button",{onClick:G,disabled:_||h>=o||N,className:"action-button compact-button",children:_?"...":"Add Punch"}),e.jsx("button",{onClick:M,disabled:!t||h>=o||N,className:"action-button compact-button qr-button",children:"Generate Punch QR"}),e.jsx("button",{onClick:K,disabled:T||!S||N,className:"action-button redeem-button compact-button danger-button",children:T?"...":"Redeem"})]})]})]}):e.jsxs("div",{className:"admin-lock compact-section",children:[e.jsx("h4",{children:"Admin Access"}),e.jsx("input",{type:"password",value:i,onChange:V,placeholder:"Enter PIN",className:"pin-input compact-input"}),e.jsx("button",{onClick:X,className:"admin-button compact-button",children:"Unlock"})]}),z&&I&&e.jsx("div",{className:"modal-overlay",onClick:()=>L(!1),children:e.jsxs("div",{className:"modal-content compact-modal",onClick:c=>c.stopPropagation(),children:[e.jsx("h4",{children:"Scan to Get Punch"}),e.jsx(me,{value:I,size:200}),e.jsx("p",{className:"qr-url-display small-text",children:I}),e.jsx("button",{onClick:()=>L(!1),className:"admin-button compact-button",children:"Close"})]})})]});return e.jsxs("div",{className:"App",children:[e.jsx("header",{className:"App-header compact-app-header",children:e.jsx("h1",{children:"Loyalty Card"})}),e.jsx("main",{className:"App-main",children:e.jsx(a.Suspense,{fallback:e.jsx("div",{children:"Loading page..."}),children:e.jsxs(re,{children:[e.jsx(U,{path:"/",element:e.jsx(Z,{})}),e.jsx(U,{path:"/claim",element:e.jsx(fe,{})})]})})})]})}ne.createRoot(document.getElementById("root")).render(e.jsxs(a.StrictMode,{children:[e.jsxs(se,{children:[" ",e.jsx(xe,{})]})," "]}));export{Q as d};
