import{d as k,e as v,b as l,j as e}from"./vendor-7EXNE9Rg.js";import{d as F}from"./index-DE21E26d.js";import{d as w,r as S,a as E}from"./vendor_firebase-BDmRcy5p.js";import"./vendor_react-dom-BdV5LJDA.js";const L=()=>{const[g]=k(),c=v(),[r,o]=l.useState("Processing your punch..."),[f,n]=l.useState(""),d=l.useRef(!1);return l.useEffect(()=>{const u=g.get("token");if(!u){n("No token provided."),o(""),d.current=!1;return}if(d.current)return;d.current=!0,(async()=>{try{if(!u.startsWith("PUNCH_TOKEN_")){n("Invalid token format."),o("");return}const t=u.split("_");if(t.length<4){n("Invalid token structure."),o("");return}const m=t[2],D=t.length>4?t[3]:"Customer";if(!m){n("Could not identify customer from token."),o("");return}await new Promise(i=>setTimeout(i,1e3));const C=w(F,"customers",m);let s=0;const a=10;await S(F,async i=>{const x=await i.get(C);if(!x.exists())throw new Error("Customer not found.");const h=x.data().punches||0;if(h>=a){s=h,setTimeout(()=>c("/"),7e3);return}const y=h+1;s=y,i.update(C,{punches:y,updatedAt:E(),lastPunchClaimedAt:E()})});let b="PUNCH SUCCESSFULLY CLAIMED!",j=`Customer ID: ${m}`,P=`You now have ${s} / ${a} punches`,p="";s>=a?p="CONGRATULATIONS! You've earned a reward!":p=`Only ${Math.max(0,a-s)} more punches until your next reward!`,o({title:b,customer:j,punches:P,reward:p,redirecting:"Redirecting shortly..."})}catch(t){console.error("Error processing punch claim:",t),n(`Error: ${t.message||"Could not process your punch. Please try again or contact support."}`),o(""),setTimeout(()=>c("/"),7e3)}})()},[g,c]),f?e.jsx("div",{style:{minHeight:"100vh",backgroundColor:"#FFFFFF",color:"#1C1C1E",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsxs("div",{style:{textAlign:"center",padding:"2rem",backgroundColor:"#FFFFFF",borderRadius:"1rem",border:"1px solid #D1D1D6",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#BF2C2C"},children:"Punch Claim Error"}),e.jsx("p",{style:{marginTop:"1rem",color:"#3C3C3E"},children:f}),e.jsx("button",{onClick:()=>c("/"),style:{marginTop:"1.5rem",padding:"0.5rem 1rem",backgroundColor:"#E5E5EA",color:"#1C1C1E",borderRadius:"0.375rem",fontWeight:"600",border:"none"},children:"Go to Homepage"})]})}):typeof r=="string"||!r.title?e.jsx("div",{style:{minHeight:"100vh",backgroundColor:"#FFFFFF",color:"#1C1C1E",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("p",{style:{fontSize:"1.25rem",animation:"pulse 1.5s infinite"},children:typeof r=="string"?r:"Processing your punch..."})}):e.jsx("div",{style:{backgroundColor:"#FFFFFF",color:"#1C1C1E",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",padding:"1rem"},children:e.jsxs("div",{style:{maxWidth:"28rem",width:"100%",textAlign:"center",padding:"1.5rem",backgroundColor:"#FFFFFF",borderRadius:"1rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)",border:"1px solid #D1D1D6"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("h2",{style:{fontSize:"0.75rem",letterSpacing:"0.1em",color:"#3C3C3E",textTransform:"uppercase",fontWeight:"600",marginBottom:"0.5rem"},children:"UFOGER Loyalty Card"}),e.jsxs("h1",{style:{fontSize:"1.875rem",fontWeight:"bold",color:"#1C1C1E"},children:["âœ… ",r.title]})]}),e.jsxs("div",{style:{backgroundColor:"#F8F8F9",color:"#3C3C3E",padding:"1.25rem",borderRadius:"0.75rem",marginTop:"1.5rem",border:"1px solid #E5E5EA"},children:[e.jsx("p",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#1D7A2E",marginBlock:"1rem"},children:"Punch successfully claimed!"}),e.jsx("p",{style:{marginBlock:"1rem",color:"#3C3C3E"},children:r.customer}),e.jsx("p",{style:{marginBlock:"1rem",color:"#3C3C3E"},children:e.jsx("strong",{children:r.punches})}),e.jsx("p",{style:{marginBlock:"1rem",color:"#3C3C3E"},children:r.reward})]}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#8E8E93",marginTop:"1.5rem",animation:"pulse 1.5s infinite"},children:r.redirecting})]})})};export{L as default};
