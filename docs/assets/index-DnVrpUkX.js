const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ClaimPunchPage-mojtr9AI.js","assets/vendor-BIzLNe23.js","assets/vendor_firebase-Dd8yIfAr.js","assets/vendor_react-dom-NUSA_c1V.js"])))=>i.map(i=>d[i]);
import{j as e,Q as M,b as o,R as ee,c as Q,B as re}from"./vendor-BIzLNe23.js";import{c as te}from"./vendor_react-dom-NUSA_c1V.js";import{i as oe,g as ne,d as _,o as se,s as P,a as v}from"./vendor_firebase-Dd8yIfAr.js";(function(){const x=document.createElement("link").relList;if(x&&x.supports&&x.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))h(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&h(m)}).observe(document,{childList:!0,subtree:!0});function c(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function h(t){if(t.ep)return;t.ep=!0;const s=c(t);fetch(t.href,s)}})();const ae="modulepreload",le=function(g){return"/loyalty_app/"+g},$={},ie=function(x,c,h){let t=Promise.resolve();if(c&&c.length>0){let m=function(i){return Promise.all(i.map(d=>Promise.resolve(d).then(r=>({status:"fulfilled",value:r}),r=>({status:"rejected",reason:r}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),j=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));t=m(c.map(i=>{if(i=le(i),i in $)return;$[i]=!0;const d=i.endsWith(".css"),r=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${r}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":ae,d||(p.as="script"),p.crossOrigin="",p.href=i,j&&p.setAttribute("nonce",j),document.head.appendChild(p),d)return new Promise((F,R)=>{p.addEventListener("load",F),p.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${i}`)))})}))}function s(m){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=m,window.dispatchEvent(l),!l.defaultPrevented)throw m}return t.then(m=>{for(const l of m||[])l.status==="rejected"&&s(l.reason);return x().catch(s)})};function ce({totalPunches:g=10,currentPunches:x=0}){const c=[];for(let h=0;h<g;h++)c.push(e.jsx("div",{style:{width:"1.25rem",height:"1.25rem",borderRadius:"50%",backgroundColor:h<x?"#32D74B":"#E5E5EA"}},h));return e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"0.5rem"},children:c})}function de({value:g="loyalty-program-user-123"}){return e.jsxs("div",{className:"qr-code-container",children:[e.jsx("h2",{children:"Scan QR Code"}),e.jsx("p",{children:"Present this QR code to earn or redeem points."}),e.jsx("div",{className:"qr-code-actual",children:g?e.jsx(M,{value:g,size:128,bgColor:"#ffffff",fgColor:"#000000",level:"L"}):e.jsx("p",{children:"No QR code data available."})})]})}const ue={apiKey:"AIzaSyB3a-4cuYh3BgstXQPI4XCiTjmuyOtzsSM",authDomain:"ufoger-loyalty.firebaseapp.com",projectId:"ufoger-loyalty",storageBucket:"ufoger-loyalty.firebasestorage.app",messagingSenderId:"474748620137",appId:"1:474748620137:web:3340ce8e46c2406e2341f8"},me=oe(ue),T=ne(me),pe=o.lazy(()=>ie(()=>import("./ClaimPunchPage-mojtr9AI.js"),__vite__mapDeps([0,1,2,3]))),fe="1234",he=({isAdminUnlocked:g,pinInput:x,handlePinInputChange:c,handlePinSubmit:h,handleLockAdmin:t,customerPhoneNumber:s,handlePhoneNumberChange:m,customerNameInput:l,handleCustomerNameChange:j,loadCustomerData:i,isLoadingCustomer:d,activeCustomerData:r,currentPunches:p,totalPunches:F,isRewardAvailable:R,addPunch:B,isSavingPunch:w,handleGeneratePunchQrCode:N,redeemReward:k,isRedeemingReward:D,feedbackMessage:y,isPunchQrModalOpen:z,actionableQrUrl:b,setIsPunchQrModalOpen:I})=>e.jsxs("div",{style:{maxWidth:"28rem",margin:"auto",display:"flex",flexDirection:"column",gap:"1.5rem"},children:[g?e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#1C1C1E"},children:"Admin Controls"}),e.jsx("button",{onClick:t,style:{backgroundColor:"#D1D1D6",color:"#1C1C1E",padding:"0.375rem 0.75rem",borderRadius:"0.375rem",fontSize:"0.75rem",border:"none"},children:"Lock"})]}),e.jsx("input",{type:"tel",value:s,onChange:m,placeholder:"Customer Phone (ID)",disabled:d,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"}}}),e.jsx("input",{type:"text",value:l,onChange:j,placeholder:"Customer Name",disabled:d,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"}}}),e.jsx("button",{onClick:i,disabled:d||!s.trim(),style:{width:"100%",backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:d?"Loading...":"Load/Create"})]}):e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsx("h2",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#1C1C1E"},children:"Admin Access"}),e.jsx("input",{type:"password",value:x,onChange:c,placeholder:"Enter PIN",style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",backgroundColor:"#FFFFFF",color:"#1C1C1E",border:"1px solid #D1D1D6","::placeholder":{color:"#8E8E93"}}}),e.jsx("button",{onClick:h,style:{width:"100%",backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:"Unlock"})]}),g&&r&&e.jsxs("div",{style:{backgroundColor:"#FFFFFF",border:"1px solid #D1D1D6",borderRadius:"1rem",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",textAlign:"center",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03)"},children:[e.jsxs("h3",{style:{color:"#1C1C1E",fontWeight:"bold",fontSize:"1.125rem"},children:[r.name||"N/A",e.jsxs("span",{style:{fontSize:"0.875rem",color:"#3C3C3E"},children:[" (",r.id,")"]})]}),e.jsx(ce,{currentPunches:p,totalPunches:F,isRewardAvailable:R}),e.jsxs("p",{style:{fontSize:"0.875rem",color:"#3C3C3E"},children:[p," / ",F]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsx("button",{onClick:B,disabled:w||p>=F||d,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:w?"...":"Add Punch"}),e.jsx("button",{onClick:N,disabled:!r||p>=F||d,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:"Generate Punch QR"}),e.jsx("button",{onClick:k,disabled:D||!R||d,style:{backgroundColor:"#E5E5EA",color:"#1C1C1E",fontWeight:"600",paddingBlock:"0.75rem",borderRadius:"0.5rem",border:"none"},children:D?"...":"Redeem"})]})]}),y.text&&e.jsx("div",{style:{position:"fixed",bottom:"1.5rem",left:"50%",transform:"translateX(-50%)",padding:"0.75rem 1.25rem",borderRadius:"0.5rem",backgroundColor:y.type==="error"?"#FFEBEB":y.type==="success"?"#E6F7E9":"#E0F2FE",color:y.type==="error"?"#BF2C2C":y.type==="success"?"#1D7A2E":"#0C5A8A",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:1e3,fontSize:"0.875rem",border:"1px solid ",borderColor:y.type==="error"?"#FAD1D1":y.type==="success"?"#C6E6CC":"#B8DFF8"},children:y.text}),z&&b&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>I(!1),children:e.jsxs("div",{style:{backgroundColor:"#ffffff",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 10px rgba(0,0,0,0.1)",textAlign:"center",color:"#333333"},onClick:L=>L.stopPropagation(),children:[e.jsx("h4",{style:{marginBottom:"15px",fontSize:"1.2rem",color:"#333333"},children:"Scan to Get Punch"}),e.jsx(de,{value:b,size:200}),e.jsx("p",{style:{fontSize:"0.8rem",marginTop:"15px",wordBreak:"break-all",color:"#555555"},children:b}),e.jsx("button",{onClick:()=>I(!1),style:{marginTop:"20px",backgroundColor:"#007bff",color:"#ffffff",padding:"10px 15px",borderRadius:"5px",border:"none",cursor:"pointer"},children:"Close"})]})})]});function ge(){const[g,x]=o.useState(0),c=10,[h,t]=o.useState(!1),[s,m]=o.useState(""),[l,j]=o.useState(""),[i,d]=o.useState(""),[r,p]=o.useState(null),[F,R]=o.useState(!1),[B,w]=o.useState(!1),[N,k]=o.useState(!1),[D,y]=o.useState(!1),[z,b]=o.useState({text:"",type:""}),[I,L]=o.useState(""),[U,O]=o.useState(!1),f=o.useRef(null);o.useEffect(()=>{r?(x(r.punches),R(r.punches>=c),!i&&r.name&&d(r.name)):(x(0),R(!1))},[r,c,i]),o.useEffect(()=>()=>{f.current&&f.current()},[]);const a=(u,n="info")=>{b({text:u,type:n}),setTimeout(()=>{b({text:"",type:""})},2500)},W=()=>{if(!r||!r.id){a("Please load a customer first.","error");return}if(r.punches>=c){a("Reward is already available. Cannot add more punches.","error");return}const u=`PUNCH_TOKEN_${r.id}_${Date.now()}_${Math.random().toString(36).substring(2,10)}`;let n;window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?(n=`${window.location.origin+"/loyalty_app/"}claim?token=${u}`,console.log("Generated local preview QR URL:",n)):(n=`https://ufoger-usa.github.io/loyalty_app/claim?token=${u}`,console.log("Generated production QR URL:",n)),L(n),O(!0),a("QR code for customer to scan and get a punch is ready.","info")},G=async()=>{if(!h){a("Please unlock admin access.","error");return}if(!r){a("Please load a customer first.","error");return}if(r.punches>=c){a("Reward is available! Please redeem before adding more punches.","error");return}k(!0),b({text:"",type:""});const u=r.punches<c?r.punches+1:r.punches,n=r.name||i.trim();try{const E=_(T,"customers",r.id);await P(E,{punches:u,name:n,updatedAt:v()},{merge:!0}),a(`Punch added for ${n||r.id}!`,"success")}catch(E){console.error("Error saving punch to Firestore:",E),a("Error saving punch. Please try again.","error")}finally{k(!1)}},q=async()=>{if(!h){a("Please unlock admin access.","error");return}if(!r||r.punches<c){a("Customer is not eligible for a reward yet or no customer loaded.","error");return}y(!0),b({text:"",type:""});const u=r.name||"Customer";try{const n=_(T,"customers",r.id);await P(n,{punches:0,lastRewardRedeemedAt:v(),updatedAt:v()},{merge:!0}),a(`Reward redeemed for ${u}! Punches reset.`,"success")}catch(n){console.error("Error redeeming reward in Firestore:",n),a("Error redeeming reward. Please try again.","error")}finally{y(!1)}},K=o.useCallback(u=>{m(u.target.value)},[]),X=()=>{s===fe?(t(!0),m(""),b({text:"",type:""})):(a("Incorrect PIN","error"),m(""))},H=()=>{t(!1),b({text:"",type:""}),p(null),j(""),d(""),f.current&&(f.current(),f.current=null)},V=o.useCallback(u=>{j(u.target.value)},[]),Y=o.useCallback(u=>{d(u.target.value)},[]),J=o.useCallback(async()=>{const u=l.trim(),n=i.trim();if(!u){a("Please enter a customer phone number.","error");return}f.current&&(f.current(),f.current=null),w(!0),b({text:"",type:""});const E=u,A=_(T,"customers",E);try{f.current=se(A,async S=>{if(w(!1),S.exists()){const C=S.data(),Z={id:S.id,punches:C.punches||0,name:C.name||"",lastRewardRedeemedAt:C.lastRewardRedeemedAt,createdAt:C.createdAt,updatedAt:C.updatedAt};p(Z),n&&n!==C.name?(await P(A,{name:n,updatedAt:v()},{merge:!0}),a("Customer name updated.","success")):!C.name&&n?(await P(A,{name:n,updatedAt:v()},{merge:!0}),a("Customer name added.","success")):a(`Customer ${C.name||E} loaded.`,"info")}else{const C={id:E,punches:0,name:n,createdAt:v(),updatedAt:v(),lastRewardRedeemedAt:null};await P(A,C),a(`New customer ${n||E} created.`,"success")}},S=>{console.error("Error in Firestore listener:",S),a("Error listening to customer data. Try reloading.","error"),w(!1),f.current&&(f.current(),f.current=null)})}catch(S){console.error("Error loading or creating customer data:",S),a("Error accessing customer data. Please try again.","error"),w(!1),f.current&&(f.current(),f.current=null)}},[l,i,f]);return e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#FFFFFF",color:"#1C1C1E",padding:"1.5rem 1rem",fontFamily:"sans-serif"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[e.jsx("h2",{style:{fontSize:"0.75rem",letterSpacing:"0.1em",color:"#3C3C3E",textTransform:"uppercase",fontWeight:"600",marginBottom:"0.25rem"},children:"UFOGER Loyalty System"}),e.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#1C1C1E"},children:"Admin Panel"})]}),e.jsx("main",{children:e.jsx(o.Suspense,{fallback:e.jsx("div",{style:{textAlign:"center",fontSize:"1.25rem",paddingTop:"2rem"},children:"Loading page..."}),children:e.jsxs(ee,{children:[e.jsx(Q,{path:"/",element:e.jsx(he,{isAdminUnlocked:h,pinInput:s,handlePinInputChange:K,handlePinSubmit:X,handleLockAdmin:H,customerPhoneNumber:l,handlePhoneNumberChange:V,customerNameInput:i,handleCustomerNameChange:Y,loadCustomerData:J,isLoadingCustomer:B,activeCustomerData:r,currentPunches:g,totalPunches:c,isRewardAvailable:F,addPunch:G,isSavingPunch:N,handleGeneratePunchQrCode:W,redeemReward:q,isRedeemingReward:D,feedbackMessage:z,isPunchQrModalOpen:U,actionableQrUrl:I,setIsPunchQrModalOpen:O})}),e.jsx(Q,{path:"/claim",element:e.jsx(pe,{})})]})})})]})}te.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(re,{basename:"/loyalty_app",children:e.jsx(ge,{})})}));export{T as d};
